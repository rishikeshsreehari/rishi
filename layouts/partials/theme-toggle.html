<script>
(function() {
    const themeToggle = document.getElementById('theme-toggle');
    if (!themeToggle) return;
    
    const icon = themeToggle.querySelector('.icon');
    const sunSVG = `{{ partial "svg.html" (dict "name" "sun") }}`;
    const moonSVG = `{{ partial "svg.html" (dict "name" "moon") }}`;
    const defaultTheme = '{{ .Site.Params.defaultTheme | default "auto" }}';
    
    function getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    
    function getEffectiveTheme(theme) {
        if (theme === 'auto') {
            return getSystemTheme();
        }
        return theme;
    }
    
    function applyTheme(theme) {
        const effectiveTheme = getEffectiveTheme(theme);
        document.documentElement.setAttribute('data-theme', effectiveTheme);
        icon.innerHTML = effectiveTheme === 'dark' ? moonSVG : sunSVG;
    }
    
    function setTheme(theme) {
        localStorage.setItem('theme', theme);
        applyTheme(theme);
    }
    
    // Initialize theme
    const savedTheme = localStorage.getItem('theme') || defaultTheme;
    applyTheme(savedTheme);
    
    // Listen for system theme changes when in auto mode
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
        const currentTheme = localStorage.getItem('theme') || defaultTheme;
        if (currentTheme === 'auto') {
            applyTheme('auto');
        }
    });
    
    // Toggle between light and dark on click
    themeToggle.addEventListener('click', () => {
        const currentTheme = localStorage.getItem('theme') || defaultTheme;
        const effectiveTheme = getEffectiveTheme(currentTheme);
        const newTheme = effectiveTheme === 'dark' ? 'light' : 'dark';
        setTheme(newTheme);
    });
})();
</script>